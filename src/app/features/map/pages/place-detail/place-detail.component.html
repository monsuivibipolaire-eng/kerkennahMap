<ng-container *ngIf="hasPlace && place as p; else loading">
  <div class="place-detail-page">

    <!-- Header du lieu -->
    <app-place-header
      [place]="p"
      [averageRating]="averageRating"
      [commentsCount]="comments.length"
      [isLoggedIn]="isLoggedIn"
      [currentUserName]="currentUserName">
    </app-place-header>

    <!-- Actions admin (modifier / supprimer) -->
    <app-place-admin-actions
      [place]="p"
      [isAdmin]="isAdmin"
      (edit)="openEditModal()"
      (delete)="onDeletePlace()">
    </app-place-admin-actions>

    <div class="mt-4 grid gap-4 lg:grid-cols-3">

      <!-- Colonne principale -->
      <div class="lg:col-span-2 space-y-4">

        <!-- Galerie média -->
        <app-place-media-gallery
          [place]="p"
          [uploadingImages]="uploadingImages"
          [uploadingVideos]="uploadingVideos"
          [uploadError]="uploadError"
          [editMode]="showEditModal"
          (addImages)="onUploadImages($event)"
          (addVideos)="onUploadVideos($event)">
        </app-place-media-gallery>

        <!-- Infos du lieu -->
        <app-place-info
          [place]="p">
        </app-place-info>

        <!-- Commentaires -->
        <app-place-comments
          [comments]="comments"
          [isLoggedIn]="isLoggedIn"
          [currentUserName]="currentUserName"
          [isSubmitting]="isSubmittingComment"
          (submitComment)="onSubmitComment($event)">
        </app-place-comments>

      </div>

      <!-- Carte -->
      <div class="space-y-3">
        <app-place-map-card
          [mapOptions]="mapOptions"
          [mapLayers]="mapLayers">
        </app-place-map-card>

        <a
          *ngIf="p.latitude && p.longitude"
          class="inline-flex items-center px-4 py-2 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700"
          style="display: block;margin: 0 auto;width: 60%;text-align: center;"
          [href]="'https://www.google.com/maps/search/?api=1&query=' + p.latitude + ',' + p.longitude"
          target="_blank"
          rel="noopener noreferrer"
        >
          Ouvrir dans Google Maps
        </a>
      </div>

    </div>

    <!-- Modale d’édition -->
    <app-place-edit-modal
      *ngIf="showEditModal && editingPlace"
      [place]="editingPlace"
      [categories]="availableCategories"
      [isSaving]="isSavingPlace"
      [uploadError]="uploadError"
      (cancel)="closeEditModal()"
      (save)="onSaveEditedPlace($event)">
    </app-place-edit-modal>

  </div>
</ng-container>

<ng-template #loading>
  <div class="p-4 text-center text-gray-500">
    Chargement du lieu...
  </div>
</ng-template>
