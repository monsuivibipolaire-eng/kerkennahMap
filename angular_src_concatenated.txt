=== BEGIN FILE: src/index.html ===
// Fichier : src/index.html
// Date d'inclusion : 2025-11-23 13:27:07

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>KerkennahMap</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
  <app-root></app-root>
</body>
</html>

=== END FILE: src/index.html ===

=== BEGIN FILE: src/app/app.component.html ===
// Fichier : src/app/app.component.html
// Date d'inclusion : 2025-11-23 13:27:07

<!-- Structure Flexbox pleine hauteur pour coller le footer en bas -->
<div class="flex flex-col h-screen">
  
  <!-- En-t√™te -->
  <app-header class="z-50"></app-header>

  <!-- Contenu Principal (La carte prendra tout l'espace restant) -->
  <main class="flex-grow relative bg-gray-100">
    <router-outlet></router-outlet>
  </main>

  <!-- Pied de page -->
  <app-footer class="z-50"></app-footer>

</div>

=== END FILE: src/app/app.component.html ===

=== BEGIN FILE: src/app/app.spec.ts ===
// Fichier : src/app/app.spec.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { TestBed } from '@angular/core/testing';
import { RouterModule } from '@angular/router';
import { App } from './app';

describe('App', () => {
  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [
        RouterModule.forRoot([])
      ],
      declarations: [
        App
      ],
    }).compileComponents();
  });

  it('should create the app', () => {
    const fixture = TestBed.createComponent(App);
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });

  it('should render title', () => {
    const fixture = TestBed.createComponent(App);
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    expect(compiled.querySelector('h1')?.textContent).toContain('Hello, kerkennah-map');
  });
});

=== END FILE: src/app/app.spec.ts ===

=== BEGIN FILE: src/app/core/models/user.model.ts ===
// Fichier : src/app/core/models/user.model.ts
// Date d'inclusion : 2025-11-23 13:27:07

export interface User {
  uid: string;
  email: string;
  displayName?: string;
  roles: ('admin' | 'user')[];
  createdAt: Date | any;
}

=== END FILE: src/app/core/models/user.model.ts ===

=== BEGIN FILE: src/app/core/models/place.model.ts ===
// Fichier : src/app/core/models/place.model.ts
// Date d'inclusion : 2025-11-23 13:27:07

export interface Place {
  id?: string;
  name: string;
  description: string;
  latitude: number;
  longitude: number;
  categories: string[];
  images: string[]; // URLs des images stock√©es (ex: Supabase)
  status: 'pending' | 'approved' | 'rejected';
  createdBy: string; // UID de l'utilisateur
  createdAt: Date | any; // 'any' pour compatibilit√© Timestamp Firestore
  updatedAt?: Date | any;
}

=== END FILE: src/app/core/models/place.model.ts ===

=== BEGIN FILE: src/app/core/components/footer/footer.component.css ===
// Fichier : src/app/core/components/footer/footer.component.css
// Date d'inclusion : 2025-11-23 13:27:07


=== END FILE: src/app/core/components/footer/footer.component.css ===

=== BEGIN FILE: src/app/core/components/footer/footer.component.ts ===
// Fichier : src/app/core/components/footer/footer.component.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';

@Component({
  selector: 'app-footer',
  standalone: true,
  imports: [CommonModule],
  templateUrl: './footer.component.html',
  styleUrls: ['./footer.component.css']
})
export class FooterComponent {}

=== END FILE: src/app/core/components/footer/footer.component.ts ===

=== BEGIN FILE: src/app/core/components/footer/footer.component.spec.ts ===
// Fichier : src/app/core/components/footer/footer.component.spec.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { FooterComponent } from './footer.component';

describe('FooterComponent', () => {
  let component: FooterComponent;
  let fixture: ComponentFixture<FooterComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [FooterComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(FooterComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

=== END FILE: src/app/core/components/footer/footer.component.spec.ts ===

=== BEGIN FILE: src/app/core/components/footer/footer.component.html ===
// Fichier : src/app/core/components/footer/footer.component.html
// Date d'inclusion : 2025-11-23 13:27:07

<footer class="bg-gray-800 text-gray-300 text-sm py-4">
  <div class="container mx-auto px-4 text-center">
    <p>&copy; 2025 Kerkennah Map. Tous droits r√©serv√©s.</p>
    <div class="mt-2 space-x-4">
      <a href="#" class="hover:text-white">Mentions l√©gales</a>
      <a href="#" class="hover:text-white">Contact</a>
    </div>
  </div>
</footer>

=== END FILE: src/app/core/components/footer/footer.component.html ===

=== BEGIN FILE: src/app/core/components/header/header.component.html ===
// Fichier : src/app/core/components/header/header.component.html
// Date d'inclusion : 2025-11-23 13:27:07

<header class="bg-blue-900 text-white shadow-md sticky top-0 z-50">
  <div class="container mx-auto px-4 py-3">
    <div class="flex justify-between items-center">
      
      <!-- Logo -->
      <a routerLink="/" class="flex items-center gap-2 text-xl font-bold tracking-wider hover:text-blue-200 transition">
        <span class="text-2xl">üèùÔ∏è</span>
        <span class="hidden sm:inline">Kerkennah Map</span>
      </a>

      <!-- Navigation Desktop -->
      <nav class="hidden md:flex items-center space-x-6">
        <a routerLink="/" routerLinkActive="text-yellow-400" [routerLinkActiveOptions]="{exact: true}" class="hover:text-blue-200 font-medium transition">Carte</a>
        
        <ng-container *ngIf="user$ | async as user">
          <a routerLink="/add-place" routerLinkActive="text-yellow-400" class="hover:text-blue-200 transition">Ajouter un lieu</a>
          <a routerLink="/admin" routerLinkActive="text-yellow-400" class="hover:text-blue-200 transition">Admin</a>
        </ng-container>
      </nav>

      <!-- Zone Utilisateur -->
      <div class="hidden md:flex items-center gap-4">
        <ng-container *ngIf="user$ | async as user; else loginBtn">
          <div class="flex items-center gap-3 bg-blue-800 rounded-full pr-4 pl-2 py-1 border border-blue-700">
            <!-- CORRECTION ICI : user.email.charAt au lieu de user.email?.charAt -->
            <div class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-sm font-bold border border-blue-400 shadow-sm">
              {{ user.email ? user.email.charAt(0).toUpperCase() : 'U' }}
            </div>
            <span class="text-sm truncate max-w-[150px] text-blue-100" title="{{ user.email }}">
              {{ user.email }}
            </span>
          </div>
          
          <button (click)="logout()" class="text-sm text-red-300 hover:text-red-100 font-medium transition">
            D√©connexion
          </button>
        </ng-container>

        <ng-template #loginBtn>
          <a routerLink="/login" class="bg-yellow-500 hover:bg-yellow-400 text-blue-900 px-4 py-2 rounded font-bold transition shadow-sm hover:shadow-md">
            Connexion
          </a>
        </ng-template>
      </div>

      <!-- Bouton Mobile Burger -->
      <button (click)="toggleMobileMenu()" class="md:hidden text-white focus:outline-none p-1 rounded hover:bg-blue-800">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path *ngIf="!isMobileMenuOpen" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          <path *ngIf="isMobileMenuOpen" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Menu Mobile -->
    <div *ngIf="isMobileMenuOpen" class="md:hidden mt-4 pb-4 border-t border-blue-800 pt-4 space-y-2 animate-fade-in">
      <a routerLink="/" (click)="isMobileMenuOpen=false" class="block py-2 hover:bg-blue-800 px-3 rounded transition">Carte</a>
      
      <ng-container *ngIf="user$ | async as user; else mobileLogin">
        <a routerLink="/add-place" (click)="isMobileMenuOpen=false" class="block py-2 hover:bg-blue-800 px-3 rounded transition">Ajouter un lieu</a>
        <a routerLink="/admin" (click)="isMobileMenuOpen=false" class="block py-2 hover:bg-blue-800 px-3 rounded transition">Administration</a>
        
        <div class="border-t border-blue-800 mt-3 pt-3 px-3">
          <p class="text-xs text-blue-400 mb-1">Connect√© en tant que</p>
          <p class="text-sm text-white mb-3 font-medium">{{ user.email }}</p>
          <button (click)="logout()" class="w-full text-center py-2 bg-red-600/20 text-red-200 rounded hover:bg-red-600/40 transition font-bold">D√©connexion</button>
        </div>
      </ng-container>

      <ng-template #mobileLogin>
        <a routerLink="/login" (click)="isMobileMenuOpen=false" class="block w-full text-center bg-yellow-500 text-blue-900 py-2 rounded font-bold mt-4 shadow-sm">
          Connexion
        </a>
      </ng-template>
    </div>
  </div>
</header>

=== END FILE: src/app/core/components/header/header.component.html ===

=== BEGIN FILE: src/app/core/components/header/header.component.spec.ts ===
// Fichier : src/app/core/components/header/header.component.spec.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { HeaderComponent } from './header.component';

describe('HeaderComponent', () => {
  let component: HeaderComponent;
  let fixture: ComponentFixture<HeaderComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [HeaderComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(HeaderComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

=== END FILE: src/app/core/components/header/header.component.spec.ts ===

=== BEGIN FILE: src/app/core/components/header/header.component.css ===
// Fichier : src/app/core/components/header/header.component.css
// Date d'inclusion : 2025-11-23 13:27:07


=== END FILE: src/app/core/components/header/header.component.css ===

=== BEGIN FILE: src/app/core/components/header/header.component.ts ===
// Fichier : src/app/core/components/header/header.component.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RouterModule, Router } from '@angular/router';
import { Observable } from 'rxjs';

// Imports corrig√©s (chemins relatifs depuis core/components/header/)
import { AuthService } from '../../services/auth.service';
import { User } from '../../models/user.model';

@Component({
  selector: 'app-header',
  standalone: true,
  imports: [CommonModule, RouterModule],
  templateUrl: './header.component.html',
  styleUrls: ['./header.component.css']
})
export class HeaderComponent {
  user$: Observable<User | null | undefined>;
  isMobileMenuOpen = false;

  constructor(private auth: AuthService, private router: Router) {
    this.user$ = this.auth.user$;
  }

  toggleMobileMenu() {
    this.isMobileMenuOpen = !this.isMobileMenuOpen;
  }

  async logout() {
    await this.auth.signOut();
    this.router.navigate(['/login']);
    this.isMobileMenuOpen = false;
  }
}

=== END FILE: src/app/core/components/header/header.component.ts ===

=== BEGIN FILE: src/app/core/services/auth.service.ts ===
// Fichier : src/app/core/services/auth.service.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Injectable, inject } from '@angular/core';
import { Auth, authState, GoogleAuthProvider, signInWithPopup, signOut, User as FirebaseUser } from '@angular/fire/auth';
import { Firestore, doc, setDoc, docData } from '@angular/fire/firestore';
import { Observable, of, from } from 'rxjs';
import { switchMap } from 'rxjs/operators';
import { User } from '../models/user.model';

@Injectable({
  providedIn: 'root'
})
export class AuthService {
  // Injection directe des services modulaires
  private auth: Auth = inject(Auth);
  private firestore: Firestore = inject(Firestore);

  user$: Observable<User | null | undefined>;

  constructor() {
    // authState() est la version modulaire de afAuth.authState
    this.user$ = authState(this.auth).pipe(
      switchMap((user: FirebaseUser | null) => {
        if (user) {
          // docData() remplace valueChanges()
          const userDocRef = doc(this.firestore, `users/${user.uid}`);
          return docData(userDocRef) as Observable<User>;
        } else {
          return of(null);
        }
      })
    );
  }

  // Connexion Google (Promise)
  async googleSignin(): Promise<void> {
    const provider = new GoogleAuthProvider();
    try {
      const credential = await signInWithPopup(this.auth, provider);
      await this.updateUserData(credential.user);
    } catch (error) {
      console.error("Erreur AuthService (Modulaire):", error);
      throw error;
    }
  }

  // D√©connexion
  async signOut(): Promise<void> {
    await signOut(this.auth);
  }

  // Mise √† jour des donn√©es utilisateur
  private async updateUserData(user: FirebaseUser): Promise<void> {
    const userDocRef = doc(this.firestore, `users/${user.uid}`);
    
    const data: User = {
      uid: user.uid,
      email: user.email || '',
      displayName: user.displayName || '',
      roles: ['user'], // Attention : merge: true prot√®ge les donn√©es existantes
      createdAt: new Date()
    };

    // setDoc avec { merge: true } remplace userRef.set(..., { merge: true })
    await setDoc(userDocRef, data, { merge: true });
  }
}

=== END FILE: src/app/core/services/auth.service.ts ===

=== BEGIN FILE: src/app/core/services/supabase-image.ts ===
// Fichier : src/app/core/services/supabase-image.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root',
})
export class SupabaseImage {
  
}

=== END FILE: src/app/core/services/supabase-image.ts ===

=== BEGIN FILE: src/app/core/services/supabase-image.service.ts ===
// Fichier : src/app/core/services/supabase-image.service.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Injectable } from '@angular/core';
import { createClient, SupabaseClient } from '@supabase/supabase-js';
import { environment } from '../../../environments/environment';

@Injectable({
  providedIn: 'root'
})
export class SupabaseImageService {
  private supabase: SupabaseClient | null = null;
  private bucketName = 'places-images';

  constructor() {
    const sbUrl = (environment as any).supabaseUrl;
    const sbKey = (environment as any).supabaseKey;

    if (sbUrl && sbKey && !sbUrl.includes('votre-projet')) {
      this.supabase = createClient(sbUrl, sbKey);
      console.log('‚úÖ Supabase initialis√© avec succ√®s.');
    } else {
      console.warn('‚ö†Ô∏è Supabase non configur√© ou cl√©s par d√©faut d√©tect√©es.');
    }
  }

  async uploadImage(file: File, path: string): Promise<string | null> {
    if (!this.supabase) {
      throw new Error('Supabase client non initialis√©. V√©rifiez environment.ts');
    }

    // 1. Upload
    console.log(`üì§ Upload vers ${this.bucketName}/${path}...`);
    const { data, error } = await this.supabase.storage
      .from(this.bucketName)
      .upload(path, file, { upsert: true });

    if (error) {
      console.error('‚ùå Erreur Upload Supabase:', error);
      throw error;
    }

    // 2. Get Public URL
    const { data: publicUrlData } = this.supabase.storage
      .from(this.bucketName)
      .getPublicUrl(path);
    
    const finalUrl = publicUrlData.publicUrl;
    console.log('‚úÖ Image upload√©e:', finalUrl);
    
    return finalUrl;
  }
}

=== END FILE: src/app/core/services/supabase-image.service.ts ===

=== BEGIN FILE: src/app/core/services/places.ts ===
// Fichier : src/app/core/services/places.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root',
})
export class Places {
  
}

=== END FILE: src/app/core/services/places.ts ===

=== BEGIN FILE: src/app/core/services/places.service.ts ===
// Fichier : src/app/core/services/places.service.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Injectable, inject } from '@angular/core';
import { Firestore, collection, collectionData, doc, docData, addDoc, query, where, updateDoc } from '@angular/fire/firestore';
import { Observable } from 'rxjs';
import { Place } from '../models/place.model';

@Injectable({
  providedIn: 'root'
})
export class PlacesService {
  private firestore: Firestore = inject(Firestore);

  constructor() {}

  // R√©cup√©rer tous les lieux approuv√©s
  getApprovedPlaces(): Observable<Place[]> {
    const placesRef = collection(this.firestore, 'places');
    const q = query(placesRef, where('status', '==', 'approved'));
    return collectionData(q, { idField: 'id' }) as Observable<Place[]>;
  }

  // R√©cup√©rer un lieu par son ID
  getPlaceById(id: string): Observable<Place | undefined> {
    const placeDocRef = doc(this.firestore, `places/${id}`);
    return docData(placeDocRef, { idField: 'id' }) as Observable<Place>;
  }

  // Ajouter un nouveau lieu
  addPlace(place: Place): Promise<any> {
    const placesRef = collection(this.firestore, 'places');
    return addDoc(placesRef, place);
  }

  // Admin: R√©cup√©rer les lieux en attente
  getPendingPlaces(): Observable<Place[]> {
    const placesRef = collection(this.firestore, 'places');
    const q = query(placesRef, where('status', '==', 'pending'));
    return collectionData(q, { idField: 'id' }) as Observable<Place[]>;
  }

  // Admin: Mettre √† jour un lieu
  updatePlace(id: string, data: Partial<Place>): Promise<void> {
    const placeDocRef = doc(this.firestore, `places/${id}`);
    return updateDoc(placeDocRef, data as any);
  }
}

=== END FILE: src/app/core/services/places.service.ts ===

=== BEGIN FILE: src/app/core/services/auth.ts ===
// Fichier : src/app/core/services/auth.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root',
})
export class Auth {
  
}

=== END FILE: src/app/core/services/auth.ts ===

=== BEGIN FILE: src/app/core/guards/auth-guard.ts ===
// Fichier : src/app/core/guards/auth-guard.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { CanActivateFn } from '@angular/router';

export const authGuard: CanActivateFn = (route, state) => {
  return true;
};

=== END FILE: src/app/core/guards/auth-guard.ts ===

=== BEGIN FILE: src/app/core/guards/auth.guard.ts ===
// Fichier : src/app/core/guards/auth.guard.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Injectable } from '@angular/core';
import { CanActivate, Router } from '@angular/router';
import { Observable } from 'rxjs';
import { map, take, tap } from 'rxjs/operators';
import { AuthService } from '../services/auth.service';

@Injectable({
  providedIn: 'root'
})
export class AuthGuard implements CanActivate {
  constructor(private auth: AuthService, private router: Router) {}

  canActivate(): Observable<boolean> {
    return this.auth.user$.pipe(
      take(1),
      map(user => !!user), // Transforme l'objet user en bool√©en
      tap(loggedIn => {
        if (!loggedIn) {
          console.log('Acc√®s refus√© : connexion requise');
          this.router.navigate(['/login']);
        }
      })
    );
  }
}

=== END FILE: src/app/core/guards/auth.guard.ts ===

=== BEGIN FILE: src/app/core/guards/admin-guard.ts ===
// Fichier : src/app/core/guards/admin-guard.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { CanActivateFn } from '@angular/router';

export const adminGuard: CanActivateFn = (route, state) => {
  return true;
};

=== END FILE: src/app/core/guards/admin-guard.ts ===

=== BEGIN FILE: src/app/core/guards/admin.guard.ts ===
// Fichier : src/app/core/guards/admin.guard.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Injectable, inject } from '@angular/core';
import { CanActivate, Router, UrlTree } from '@angular/router';
import { Auth, authState, getIdTokenResult } from '@angular/fire/auth';
import { Observable } from 'rxjs';
import { map, take, switchMap } from 'rxjs/operators';

@Injectable({
  providedIn: 'root'
})
export class AdminGuard implements CanActivate {
  private auth = inject(Auth);
  private router = inject(Router);

  canActivate(): Observable<boolean | UrlTree> {
    // On √©coute l'√©tat d'authentification
    return authState(this.auth).pipe(
      take(1), // On prend juste la valeur actuelle
      switchMap(async (user) => {
        if (!user) {
          console.warn('AdminGuard: Pas d\'utilisateur connect√©.');
          return false;
        }

        // On force le rafra√Æchissement du token pour avoir les derniers claims
        // (Important si on vient de lancer le script setAdmin.js)
        const tokenResult = await getIdTokenResult(user, true);
        
        // On v√©rifie si le claim 'admin' est pr√©sent et vrai
        const isAdmin = !!tokenResult.claims['admin'];

        if (isAdmin) {
          console.log('‚úÖ AdminGuard: Acc√®s autoris√©.');
          return true;
        } else {
          console.error('‚õî AdminGuard: Acc√®s refus√©. Claims:', tokenResult.claims);
          return false;
        }
      }),
      map(isAuthorized => {
        if (isAuthorized) return true;
        
        // Si refus√©, redirection vers l'accueil avec un param√®tre d'erreur
        // return this.router.createUrlTree(['/'], { queryParams: { error: 'admin_required' } });
        
        // Ou simplement false (la page ne chargera pas)
        alert('Acc√®s refus√© : droits administrateur requis');
        return this.router.createUrlTree(['/']); 
      })
    );
  }
}

=== END FILE: src/app/core/guards/admin.guard.ts ===

=== BEGIN FILE: src/app/app.routes.ts ===
// Fichier : src/app/app.routes.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Routes } from '@angular/router';
import { MapPageComponent } from './features/map/pages/map-page/map-page.component';
import { PlaceDetailComponent } from './features/map/pages/place-detail/place-detail.component';
import { AddPlaceComponent } from './features/admin/pages/add-place/add-place.component';
import { LoginComponent } from './features/auth/pages/login/login.component';
import { AdminListComponent } from './features/admin/pages/admin-list/admin-list.component';
import { AuthGuard } from './core/guards/auth.guard';
import { AdminGuard } from './core/guards/admin.guard';

export const routes: Routes = [
  { path: '', component: MapPageComponent },
  { path: 'place/:id', component: PlaceDetailComponent },
  { path: 'add-place', component: AddPlaceComponent, canActivate: [AuthGuard] },
  { path: 'login', component: LoginComponent },
  { 
    path: 'admin',
    canActivate: [AdminGuard],
    children: [
        { path: 'places', component: AdminListComponent },
        { path: '', redirectTo: 'places', pathMatch: 'full' }
    ]
  },
  { path: '**', redirectTo: '' }
];

=== END FILE: src/app/app.routes.ts ===

=== BEGIN FILE: src/app/app.component.spec.ts ===
// Fichier : src/app/app.component.spec.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { AppComponent } from './app.component';

describe('AppComponent', () => {
  let component: AppComponent;
  let fixture: ComponentFixture<AppComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [AppComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(AppComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

=== END FILE: src/app/app.component.spec.ts ===

=== BEGIN FILE: src/app/features/auth/pages/login/login.component.spec.ts ===
// Fichier : src/app/features/auth/pages/login/login.component.spec.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { LoginComponent } from './login.component';

describe('LoginComponent', () => {
  let component: LoginComponent;
  let fixture: ComponentFixture<LoginComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [LoginComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(LoginComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

=== END FILE: src/app/features/auth/pages/login/login.component.spec.ts ===

=== BEGIN FILE: src/app/features/auth/pages/login/login.component.ts ===
// Fichier : src/app/features/auth/pages/login/login.component.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';
import { Router } from '@angular/router';
import { AuthService } from '../../../../core/services/auth.service';

@Component({
  selector: 'app-login',
  standalone: true,
  imports: [CommonModule],
  templateUrl: './login.component.html',
  styleUrls: ['./login.component.css']
})
export class LoginComponent {
  isLoading = false;
  errorMessage = '';
  debugInfo = ''; // Ajout pour voir l'erreur brute

  constructor(private auth: AuthService, private router: Router) {}

  async loginWithGoogle() {
    this.isLoading = true;
    this.errorMessage = '';
    this.debugInfo = '';
    
    try {
      console.log('Tentative de connexion Google...');
      await this.auth.googleSignin();
      console.log('Connexion r√©ussie !');
      this.router.navigate(['/']);
    } catch (err: any) {
      console.error('Erreur login d√©taill√©e:', err);
      
      // Affichage de l'erreur brute pour le d√©veloppeur
      this.debugInfo = JSON.stringify(err, null, 2);
      
      if (err.code === 'auth/popup-closed-by-user') {
        this.errorMessage = "Connexion annul√©e par l'utilisateur.";
      } else if (err.code === 'auth/configuration-not-found') {
        this.errorMessage = "Google Auth n'est pas activ√© dans la console Firebase.";
      } else if (err.code === 'auth/unauthorized-domain') {
        this.errorMessage = "Le domaine localhost n'est pas autoris√© dans Firebase Auth.";
      } else {
        this.errorMessage = "Erreur : " + (err.message || "Inconnue");
      }
    } finally {
      this.isLoading = false;
    }
  }
}

=== END FILE: src/app/features/auth/pages/login/login.component.ts ===

=== BEGIN FILE: src/app/features/auth/pages/login/login.component.css ===
// Fichier : src/app/features/auth/pages/login/login.component.css
// Date d'inclusion : 2025-11-23 13:27:07


=== END FILE: src/app/features/auth/pages/login/login.component.css ===

=== BEGIN FILE: src/app/features/auth/pages/login/login.component.html ===
// Fichier : src/app/features/auth/pages/login/login.component.html
// Date d'inclusion : 2025-11-23 13:27:07

<div class="min-h-[calc(100vh-140px)] flex items-center justify-center bg-gray-50 px-4">
  <div class="max-w-md w-full bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100">
    <div class="bg-blue-600 px-8 py-6 text-center">
      <h2 class="text-2xl font-bold text-white">Bienvenue !</h2>
      <p class="text-blue-100 mt-2">Connectez-vous pour g√©rer vos lieux</p>
    </div>

    <div class="p-8 space-y-6">
      <!-- Message d'erreur -->
      <div *ngIf="errorMessage" class="bg-red-50 text-red-600 p-3 rounded-lg text-sm border border-red-100">
        <strong>Oups !</strong> {{ errorMessage }}
      </div>

      <!-- Zone de Debug (Visible seulement si erreur) -->
      <div *ngIf="debugInfo" class="bg-gray-800 text-green-400 p-3 rounded text-xs overflow-auto max-h-40 font-mono">
        DEBUG: {{ debugInfo }}
      </div>

      <button (click)="loginWithGoogle()" 
              [disabled]="isLoading"
              class="w-full flex items-center justify-center gap-3 px-4 py-3 border border-gray-300 rounded-lg shadow-sm bg-white text-gray-700 font-medium hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all disabled:opacity-70">
        <span>Continuer avec Google</span>
      </button>
    </div>
  </div>
</div>

=== END FILE: src/app/features/auth/pages/login/login.component.html ===

=== BEGIN FILE: src/app/features/admin/pages/add-place/add-place.component.html ===
// Fichier : src/app/features/admin/pages/add-place/add-place.component.html
// Date d'inclusion : 2025-11-23 13:27:07

<div class="container mx-auto p-6 max-w-3xl">
  
  <div class="bg-white rounded-xl shadow-lg p-8">
    <h1 class="text-2xl font-bold text-blue-900 mb-6 border-b pb-2">Ajouter un nouveau lieu</h1>

    <!-- Messages -->
    <div *ngIf="errorMessage" class="mb-4 bg-red-50 text-red-600 p-3 rounded border border-red-100">
      {{ errorMessage }}
    </div>
    <div *ngIf="successMessage" class="mb-4 bg-green-50 text-green-600 p-3 rounded border border-green-100">
      {{ successMessage }}
    </div>

    <form (ngSubmit)="onSubmit()" #placeForm="ngForm" class="space-y-6">
      
      <!-- Nom -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">Nom du lieu *</label>
        <input type="text" [(ngModel)]="model.name" name="name" required
               class="w-full p-3 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none"
               placeholder="Ex: Restaurant La Sir√®ne">
      </div>

      <!-- Description -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">Description *</label>
        <textarea [(ngModel)]="model.description" name="description" required rows="3"
                  class="w-full p-3 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none"
                  placeholder="D√©crivez ce lieu..."></textarea>
      </div>

      <!-- Cat√©gories -->
      <div>
        <label class="block text-gray-700 font-medium mb-2">Cat√©gories</label>
        <div class="flex flex-wrap gap-3">
          <label *ngFor="let cat of categoriesList" class="flex items-center space-x-2 bg-gray-50 px-3 py-2 rounded border cursor-pointer hover:bg-blue-50">
            <input type="checkbox" (change)="toggleCategory(cat, $event)" class="rounded text-blue-600">
            <span class="text-gray-700 text-sm">{{ cat }}</span>
          </label>
        </div>
      </div>

      <!-- Position (Carte) -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">Position (Cliquez sur la carte) *</label>
        <p class="text-xs text-gray-500 mb-2">Lat: {{ model.latitude | number:'1.4-4' }}, Lng: {{ model.longitude | number:'1.4-4' }}</p>
        
        <div class="h-64 w-full rounded overflow-hidden border border-gray-300 relative z-0">
          <div class="h-full w-full"
               leaflet 
               [leafletOptions]="mapOptions"
               [leafletLayers]="mapLayers"
               (leafletMapReady)="onMapReady($event)">
          </div>
        </div>
      </div>

      <!-- Images -->
      <div>
        <label class="block text-gray-700 font-medium mb-1">Photo</label>
        <input type="file" (change)="onFileSelected($event)" accept="image/*"
               class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
        
        <div *ngIf="uploadingImage" class="text-sm text-blue-600 mt-1">T√©l√©chargement en cours...</div>
        
        <!-- Pr√©visualisation -->
        <div *ngIf="model.images && model.images.length > 0" class="mt-2 flex gap-2">
          <img *ngFor="let img of model.images" [src]="img" class="h-20 w-20 object-cover rounded border">
        </div>
      </div>

      <!-- Bouton Soumettre -->
      <div class="pt-4">
        <button type="submit" 
                [disabled]="!placeForm.form.valid || isSubmitting || uploadingImage"
                class="w-full bg-blue-600 text-white font-bold py-3 rounded hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed">
          <span *ngIf="!isSubmitting">Ajouter le lieu</span>
          <span *ngIf="isSubmitting">Enregistrement...</span>
        </button>
      </div>

    </form>
  </div>
</div>

=== END FILE: src/app/features/admin/pages/add-place/add-place.component.html ===

=== BEGIN FILE: src/app/features/admin/pages/add-place/add-place.component.spec.ts ===
// Fichier : src/app/features/admin/pages/add-place/add-place.component.spec.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { AddPlaceComponent } from './add-place.component';

describe('AddPlaceComponent', () => {
  let component: AddPlaceComponent;
  let fixture: ComponentFixture<AddPlaceComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [AddPlaceComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(AddPlaceComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

=== END FILE: src/app/features/admin/pages/add-place/add-place.component.spec.ts ===

=== BEGIN FILE: src/app/features/admin/pages/add-place/add-place.component.ts ===
// Fichier : src/app/features/admin/pages/add-place/add-place.component.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { LeafletModule } from '@bluehalo/ngx-leaflet';
import * as L from 'leaflet';
import { Router } from '@angular/router';
import { PlacesService } from '../../../../core/services/places.service';
import { SupabaseImageService } from '../../../../core/services/supabase-image.service';
import { AuthService } from '../../../../core/services/auth.service';
import { Place } from '../../../../core/models/place.model';
import { take } from 'rxjs/operators';
import { firstValueFrom } from 'rxjs';

@Component({
  selector: 'app-add-place',
  standalone: true,
  imports: [CommonModule, FormsModule, LeafletModule],
  templateUrl: './add-place.component.html',
  styleUrls: ['./add-place.component.css']
})
export class AddPlaceComponent implements OnInit {
  model: Partial<Place> = {
    name: '', description: '', latitude: 34.71, longitude: 11.15,
    categories: [], status: 'pending', images: []
  };
  
  categoriesList = ['Restaurant', 'Caf√©', 'Plage', 'H√¥tel', 'Histoire', 'P√™che', 'Commerce'];
  isSubmitting = false;
  uploadingImage = false;
  errorMessage = '';
  successMessage = '';
  
  mapOptions: L.MapOptions = {
    layers: [L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 })],
    zoom: 10, center: L.latLng(34.71, 11.15)
  };
  marker: L.Marker | null = null;

  constructor(
    private placesService: PlacesService,
    private imageService: SupabaseImageService,
    private auth: AuthService,
    private router: Router
  ) {
     // Fix Leaflet Icons
     const iconRetinaUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png';
     const iconUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png';
     const shadowUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png';
     L.Marker.prototype.options.icon = L.icon({
       iconRetinaUrl, iconUrl, shadowUrl,
       iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], tooltipAnchor: [16, -28], shadowSize: [41, 41]
     });
  }

  ngOnInit(): void {
    this.updateMarker(this.model.latitude!, this.model.longitude!);
  }

  onMapReady(map: L.Map) {
    map.on('click', (e: L.LeafletMouseEvent) => {
      this.model.latitude = e.latlng.lat;
      this.model.longitude = e.latlng.lng;
      this.updateMarker(e.latlng.lat, e.latlng.lng);
    });
  }

  updateMarker(lat: number, lng: number) {
    if (this.marker) this.marker.setLatLng([lat, lng]);
    else this.marker = L.marker([lat, lng]);
  }

  get mapLayers(): L.Layer[] { return this.marker ? [this.marker] : []; }

  toggleCategory(cat: string, event: any) {
    if (event.target.checked) this.model.categories?.push(cat);
    else {
      const index = this.model.categories?.indexOf(cat);
      if (index !== undefined && index > -1) this.model.categories?.splice(index, 1);
    }
  }

  async onFileSelected(event: any) {
    const file = event.target.files[0];
    if (!file) return;

    this.uploadingImage = true;
    this.errorMessage = '';
    
    try {
      // G√©n√©ration nom unique: timestamp_nom
      const fileName = Date.now() + '_' + file.name.replace(/[^a-zA-Z0-9.]/g, '_');
      const path = `places/${fileName}`;
      
      console.log('D√©but upload:', path);
      const url = await this.imageService.uploadImage(file, path);
      
      if (url) {
        this.model.images?.push(url);
      }
    } catch (err: any) {
      console.error('Upload failed', err);
      this.errorMessage = "Erreur Upload: " + (err.message || "V√©rifiez votre config Supabase");
    } finally {
      this.uploadingImage = false;
    }
  }

  async onSubmit() {
    this.isSubmitting = true;
    this.errorMessage = '';

    try {
      const user = await firstValueFrom(this.auth.user$);
      if (!user) {
        this.errorMessage = "Vous devez √™tre connect√©.";
        this.isSubmitting = false;
        return;
      }

      const placeData: Place = {
        ...this.model as Place,
        createdBy: user.uid,
        createdAt: new Date(),
        status: 'approved' // Auto-approve pour simplifier le test
      };

      await this.placesService.addPlace(placeData);
      
      this.successMessage = "Lieu ajout√© avec succ√®s !";
      setTimeout(() => this.router.navigate(['/']), 1500);

    } catch (err) {
      console.error(err);
      this.errorMessage = "Erreur lors de l'enregistrement.";
    } finally {
      this.isSubmitting = false;
    }
  }
}

=== END FILE: src/app/features/admin/pages/add-place/add-place.component.ts ===

=== BEGIN FILE: src/app/features/admin/pages/add-place/add-place.component.css ===
// Fichier : src/app/features/admin/pages/add-place/add-place.component.css
// Date d'inclusion : 2025-11-23 13:27:07


=== END FILE: src/app/features/admin/pages/add-place/add-place.component.css ===

=== BEGIN FILE: src/app/features/admin/pages/admin-list/admin-list.component.ts ===
// Fichier : src/app/features/admin/pages/admin-list/admin-list.component.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Component, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { PlacesService } from '../../../../core/services/places.service';
import { Place } from '../../../../core/models/place.model';

@Component({
  selector: 'app-admin-list',
  standalone: true,
  imports: [CommonModule],
  templateUrl: './admin-list.component.html',
  styles: [`
    .card { @apply bg-white rounded-lg shadow p-6 mb-4; }
    .btn-seed { @apply bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition; }
  `]
})
export class AdminListComponent {
  private placesService = inject(PlacesService);
  
  isLoading = false;
  message = '';

  // Donn√©es statiques √† injecter
  kerkennahPlaces: Partial<Place>[] = [
    {
      name: "Borj El Hissar",
      description: "Ancien fort hispano-turc situ√© pr√®s de Sidi Fredj. Un site historique incontournable offrant une vue imprenable sur la mer.",
      latitude: 34.7089,
      longitude: 11.1644,
      categories: ["Histoire", "Tourisme"],
      status: "approved",
      images: ["https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/Borj_El_Hissar_-_Kerkennah_-_Tunisie.jpg/800px-Borj_El_Hissar_-_Kerkennah_-_Tunisie.jpg"]
    },
    {
      name: "Mus√©e du Patrimoine Insulaire (Sidi Abbes)",
      description: "Un mus√©e fascinant √† El Abbassia qui retrace l'histoire, les traditions et le mode de vie unique des habitants de l'archipel.",
      latitude: 34.7255,
      longitude: 11.2485,
      categories: ["Culture", "Mus√©e"],
      status: "approved",
      images: ["https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Mus%C3%A9e_du_patrimoine_insulaire_de_Kerkennah_04.jpg/800px-Mus%C3%A9e_du_patrimoine_insulaire_de_Kerkennah_04.jpg"]
    },
    {
      name: "Port de Sidi Youssef",
      description: "Le point d'entr√©e principal de l'archipel via le ferry (Loud). Un lieu vivant o√π l'on prend le pouls de l'√Æle.",
      latitude: 34.6542,
      longitude: 10.9987,
      categories: ["Transport", "Port"],
      status: "approved",
      images: ["https://upload.wikimedia.org/wikipedia/commons/thumb/d/d9/Arriv%C3%A9e_du_bac_%C3%A0_Sidi_Youssef_01.jpg/800px-Arriv%C3%A9e_du_bac_%C3%A0_Sidi_Youssef_01.jpg"]
    },
    {
      name: "Plage de Sidi Fredj",
      description: "Une des plages les plus populaires, id√©ale pour la baignade et les couchers de soleil spectaculaires.",
      latitude: 34.7050,
      longitude: 11.1500,
      categories: ["Plage", "D√©tente"],
      status: "approved",
      images: ["https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/Plage_de_Sidi_Fekhri_01.jpg/800px-Plage_de_Sidi_Fekhri_01.jpg"] // Image g√©n√©rique plage
    },
    {
      name: "Grand H√¥tel Kerkennah",
      description: "Un h√¥tel historique situ√© les pieds dans l'eau √† Sidi Fredj, connu pour son architecture typique.",
      latitude: 34.7065,
      longitude: 11.1520,
      categories: ["H√¥tel", "Restaurant"],
      status: "approved",
      images: ["https://dynamic-media-cdn.tripadvisor.com/media/photo-o/12/04/25/8e/grand-hotel-kerkennah.jpg?w=1200&h=-1&s=1"]
    },
    {
      name: "Site Arch√©ologique de Kerkouane (Similaire)",
      description: "Ruines antiques t√©moignant du pass√© punique et romain de l'archipel (Cercina).",
      latitude: 34.6900,
      longitude: 11.1200,
      categories: ["Histoire", "Ruines"],
      status: "approved",
      images: ["https://upload.wikimedia.org/wikipedia/commons/thumb/a/a8/Ruines_romaines_%C3%A0_Kerkennah.jpg/800px-Ruines_romaines_%C3%A0_Kerkennah.jpg"]
    },
    {
      name: "Village de Remla",
      description: "Le chef-lieu administratif de l'archipel. On y trouve le march√©, la poste et l'animation locale.",
      latitude: 34.7130,
      longitude: 11.1950,
      categories: ["Ville", "Commerce"],
      status: "approved",
      images: ["https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Remla_centre_ville.jpg/800px-Remla_centre_ville.jpg"]
    },
    {
      name: "Port de P√™che El Attaya",
      description: "Un village de p√™cheurs authentique √† la pointe nord. C√©l√®bre pour ses techniques de p√™che traditionnelles (Charfia).",
      latitude: 34.7450,
      longitude: 11.2800,
      categories: ["P√™che", "Authentique"],
      status: "approved",
      images: ["https://upload.wikimedia.org/wikipedia/commons/thumb/f/f2/Port_d%27El_Attaya_02.jpg/800px-Port_d%27El_Attaya_02.jpg"]
    },
    {
      name: "Restaurant Le Sirene",
      description: "Sp√©cialit√©s de fruits de mer frais p√™ch√©s localement. Une institution culinaire.",
      latitude: 34.7070,
      longitude: 11.1550,
      categories: ["Restaurant", "Gastronomie"],
      status: "approved",
      images: ["https://media-cdn.tripadvisor.com/media/photo-s/1a/43/6e/58/terrasse.jpg"]
    },
    {
      name: "Archipel des √Ælots inhabit√©s",
      description: "Excursion en bateau vers les √Ælots sauvages autour de Gremdi. Nature pr√©serv√©e.",
      latitude: 34.7600,
      longitude: 11.3000,
      categories: ["Nature", "Aventure"],
      status: "approved",
      images: ["https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Kerkennah_Paysage.jpg/800px-Kerkennah_Paysage.jpg"]
    }
  ];

  async seedDatabase() {
    if (!confirm('Voulez-vous vraiment injecter ces 10 lieux dans Firebase ?')) return;
    
    this.isLoading = true;
    this.message = 'Injection en cours...';
    let count = 0;

    try {
      for (const place of this.kerkennahPlaces) {
        // On ajoute un cr√©ateur fictif 'System'
        const data = { ...place, createdBy: 'system_seeder', createdAt: new Date() } as Place;
        await this.placesService.addPlace(data);
        count++;
      }
      this.message = `‚úÖ Succ√®s ! ${count} lieux ajout√©s. Allez voir la carte !`;
    } catch (err) {
      console.error(err);
      this.message = '‚ùå Erreur lors de l\'injection.';
    } finally {
      this.isLoading = false;
    }
  }
}

=== END FILE: src/app/features/admin/pages/admin-list/admin-list.component.ts ===

=== BEGIN FILE: src/app/features/admin/pages/admin-list/admin-list.component.spec.ts ===
// Fichier : src/app/features/admin/pages/admin-list/admin-list.component.spec.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { AdminListComponent } from './admin-list.component';

describe('AdminListComponent', () => {
  let component: AdminListComponent;
  let fixture: ComponentFixture<AdminListComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [AdminListComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(AdminListComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

=== END FILE: src/app/features/admin/pages/admin-list/admin-list.component.spec.ts ===

=== BEGIN FILE: src/app/features/admin/pages/admin-list/admin-list.component.html ===
// Fichier : src/app/features/admin/pages/admin-list/admin-list.component.html
// Date d'inclusion : 2025-11-23 13:27:07

<div class="container mx-auto p-6">
  <h1 class="text-3xl font-bold text-blue-900 mb-8">Administration</h1>

  
  <!-- Ici, on pourrait afficher la liste r√©elle des lieux pour les mod√©rer plus tard -->
  <div class="mt-8 text-gray-400 text-center italic">
    (La liste de mod√©ration sera d√©velopp√©e ult√©rieurement)
  </div>
</div>

=== END FILE: src/app/features/admin/pages/admin-list/admin-list.component.html ===

=== BEGIN FILE: src/app/features/admin/pages/admin-list/admin-list.component.css ===
// Fichier : src/app/features/admin/pages/admin-list/admin-list.component.css
// Date d'inclusion : 2025-11-23 13:27:07


=== END FILE: src/app/features/admin/pages/admin-list/admin-list.component.css ===

=== BEGIN FILE: src/app/features/map/pages/map-page/map-page.component.html ===
// Fichier : src/app/features/map/pages/map-page/map-page.component.html
// Date d'inclusion : 2025-11-23 13:27:07

<div class="flex h-full relative">
  
  <!-- Sidebar -->
  <aside class="w-full md:w-1/3 lg:w-1/4 bg-white shadow-xl z-20 overflow-y-auto hidden md:flex flex-col border-r border-gray-200">
    
    <!-- Header Sidebar -->
    <div class="p-4 bg-blue-50 border-b border-blue-100 sticky top-0 z-10">
      <h2 class="text-xl font-bold text-blue-900">Lieux √† d√©couvrir</h2>
      <p class="text-sm text-gray-600">{{ places.length }} lieux trouv√©s</p>
    </div>

    <!-- Liste -->
    <div class="flex-grow overflow-y-auto">
      <ul class="divide-y divide-gray-100">
        <li *ngFor="let place of places" 
            class="p-4 hover:bg-blue-50 cursor-pointer transition duration-150 group"
            [routerLink]="['/place', place.id]">
          <div class="flex justify-between items-start">
            <div>
              <h3 class="font-semibold text-gray-800 group-hover:text-blue-600">{{ place.name }}</h3>
              <div class="flex flex-wrap gap-1 mt-1">
                <span *ngFor="let cat of place.categories" 
                      class="text-xs bg-gray-200 text-gray-700 px-2 py-0.5 rounded-full">
                  {{ cat }}
                </span>
              </div>
            </div>
            <!-- Indicateur visuel simple -->
            <span class="text-gray-300 text-lg">‚Ä∫</span>
          </div>
        </li>
        
        <li *ngIf="places.length === 0" class="p-8 text-center text-gray-500">
          Chargement des lieux...
        </li>
      </ul>
    </div>

    <!-- Footer Sidebar (Bouton Ajout seul) -->
    <div class="p-4 border-t border-gray-100 bg-gray-50">
      <a routerLink="/add-place" class="block w-full text-center bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition shadow-sm font-medium">
        + Ajouter un lieu
      </a>
    </div>

  </aside>

  <!-- Carte Leaflet -->
  <div class="flex-grow relative z-10 h-full w-full">
    <div class="h-full w-full"
         leaflet 
         [leafletOptions]="options"
         [leafletLayers]="layers"
         (leafletMapReady)="onMapReady($event)">
    </div>
  </div>
  
</div>

=== END FILE: src/app/features/map/pages/map-page/map-page.component.html ===

=== BEGIN FILE: src/app/features/map/pages/map-page/map-page.component.spec.ts ===
// Fichier : src/app/features/map/pages/map-page/map-page.component.spec.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { MapPageComponent } from './map-page.component';

describe('MapPageComponent', () => {
  let component: MapPageComponent;
  let fixture: ComponentFixture<MapPageComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [MapPageComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(MapPageComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

=== END FILE: src/app/features/map/pages/map-page/map-page.component.spec.ts ===

=== BEGIN FILE: src/app/features/map/pages/map-page/map-page.component.css ===
// Fichier : src/app/features/map/pages/map-page/map-page.component.css
// Date d'inclusion : 2025-11-23 13:27:07

:host { display: block; height: 100%; }

/* Popup Image Styles */
::ng-deep .popup-image {
  width: 100% !important;
  height: 130px !important;
  object-fit: cover;
  border-radius: 6px;
  background-color: #f3f4f6;
  margin-bottom: 10px;
  border: 1px solid #e5e7eb;
}
::ng-deep .leaflet-popup-content { 
  width: 220px !important; 
  margin: 12px !important; 
}
::ng-deep .leaflet-popup-content-wrapper {
  border-radius: 10px;
  overflow: hidden;
  padding: 0;
}

/* --- CUSTOM MARKER STYLES --- */
::ng-deep .custom-div-icon {
  background: transparent;
  border: none;
}

::ng-deep .marker-pin {
  width: 42px;
  height: 42px;
  border-radius: 50% 50% 50% 0;
  position: absolute;
  transform: rotate(-45deg);
  left: 50%;
  top: 50%;
  margin: -21px 0 0 -21px;
  box-shadow: 2px 4px 8px rgba(0,0,0,0.4); /* Ombre port√©e plus marqu√©e */
  display: flex;
  align-items: center;
  justify-content: center;
  border: 3px solid white; /* Bordure blanche √©paisse */
  transition: transform 0.2s ease;
}

/* Effet au survol (optionnel si interactif) */
::ng-deep .marker-pin:hover {
  transform: rotate(-45deg) scale(1.1);
  z-index: 1000;
}

/* --- PALETTE DE COULEURS --- */
/* Rouge vif */
::ng-deep .marker-pin.restaurant { background: #ef4444; }
/* Violet/Indigo */
::ng-deep .marker-pin.hotel { background: #6366f1; }
/* Jaune Soleil */
::ng-deep .marker-pin.plage { background: #f59e0b; }
/* Marron Caf√© */
::ng-deep .marker-pin.cafe { background: #78350f; }
/* Cyan Oc√©an */
::ng-deep .marker-pin.port { background: #06b6d4; }
/* Vert √âmeraude (Culture/Mosqu√©e) */
::ng-deep .marker-pin.culture { background: #10b981; }
/* Bleu Roi (√âcole/Admin) */
::ng-deep .marker-pin.ecole { background: #2563eb; }
/* Rose/Rouge (Sant√©) */
::ng-deep .marker-pin.sante { background: #e11d48; }
/* Gris (Par d√©faut) */
::ng-deep .marker-pin.default { background: #64748b; }

/* Correction de l'orientation de l'emoji √† l'int√©rieur */
::ng-deep .marker-pin span {
  transform: rotate(45deg);
  font-size: 22px;
  line-height: 1;
  filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1));
}

=== END FILE: src/app/features/map/pages/map-page/map-page.component.css ===

=== BEGIN FILE: src/app/features/map/pages/map-page/map-page.component.ts ===
// Fichier : src/app/features/map/pages/map-page/map-page.component.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Component, OnInit, OnDestroy } from '@angular/core';
import { CommonModule } from '@angular/common';
import { LeafletModule } from '@bluehalo/ngx-leaflet';
import { Router, RouterModule } from '@angular/router';
import * as L from 'leaflet';
import { Subscription } from 'rxjs';

import { PlacesService } from '../../../../core/services/places.service';
import { Place } from '../../../../core/models/place.model';
import { AuthService } from '../../../../core/services/auth.service';
import { User } from '../../../../core/models/user.model';

@Component({
  selector: 'app-map-page',
  standalone: true,
  imports: [CommonModule, LeafletModule, RouterModule],
  templateUrl: './map-page.component.html',
  styleUrls: ['./map-page.component.css']
})
export class MapPageComponent implements OnInit, OnDestroy {
  options: L.MapOptions = {
    layers: [L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 })],
    zoom: 11,
    center: L.latLng(34.71, 11.15)
  };

  places: Place[] = [];
  layers: L.Layer[] = [];

  private subPlaces: Subscription = new Subscription();
  private subUser: Subscription = new Subscription();
  private map: L.Map | null = null;
  private isAdmin = false;

  constructor(
    private placesService: PlacesService,
    private router: Router,
    private authService: AuthService
  ) {
    const iconRetinaUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png';
    const iconUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png';
    const shadowUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png';

    L.Marker.prototype.options.icon = L.icon({
      iconRetinaUrl,
      iconUrl,
      shadowUrl,
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      tooltipAnchor: [16, -28],
      shadowSize: [41, 41]
    });
  }

  ngOnInit(): void {
    this.subUser = this.authService.user$.subscribe((user: User | null | undefined) => {
      this.isAdmin = !!user && Array.isArray(user.roles) && user.roles.includes('admin');
    });

    this.subPlaces = this.placesService.getApprovedPlaces().subscribe(data => {
      this.places = data || [];
      this.updateMarkers();
    });
  }

  ngOnDestroy(): void {
    this.subPlaces.unsubscribe();
    this.subUser.unsubscribe();
  }

  onMapReady(map: L.Map): void {
    this.map = map;
    this.updateMarkers();
  }

  private updateMarkers(): void {
    if (!this.map) {
      return;
    }

    this.layers = this.places.map(p => {
      const marker = L.marker([p.latitude, p.longitude], {
        icon: this.getIcon(p.categories || [])
      });

      const img = (p.images && p.images.length > 0)
        ? p.images[0]
        : 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/300px-No_image_available.svg.png';

      const adminButtonHtml = this.isAdmin ? `
        <button id="edit-${p.id}"
                class="mt-2 bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-full text-xs shadow-sm w-full">
          ‚úèÔ∏è Modifier
        </button>` : '';

      marker.bindPopup(`
        <div class="text-center font-sans">
          <h3 class="font-bold text-base text-gray-800 mb-2 truncate">${p.name}</h3>
          <div class="relative">
            <img src="${img}" class="popup-image" onerror="this.src='https://via.placeholder.com/300?text=Image+Indisponible'">
            <span class="absolute bottom-3 right-1 bg-white/80 px-1 rounded text-[10px] font-bold text-gray-600">
              ${(p.categories && p.categories[0]) || 'Lieu'}
            </span>
          </div>
          <button id="btn-${p.id}"
                  class="mt-3 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full text-sm transition shadow-sm flex items-center justify-center gap-1 w-full">
            <span>üëÅÔ∏è</span> Voir D√©tails
          </button>
          ${adminButtonHtml}
        </div>
      `);

      marker.on('popupopen', () => {
        const btn = document.getElementById(`btn-${p.id}`);
        if (btn) {
          btn.addEventListener('click', () => this.router.navigate(['/place', p.id]));
        }

        const editBtn = document.getElementById(`edit-${p.id}`);
        if (editBtn && this.isAdmin) {
          editBtn.addEventListener('click', () =>
            this.router.navigate(['/place', p.id], { queryParams: { edit: '1' } })
          );
        }
      });

      return marker;
    });
  }

  private getIcon(categories: string[]): L.DivIcon {
    let type = 'default';
    let emoji = 'üìç';

    const c = categories.map(x => x.toLowerCase()).join(' ');

    if (c.includes('pharmacie') || c.includes('h√¥pital') || c.includes('sant√©') || c.includes('urgences')) {
      type = 'sante'; emoji = 'üè•';
    } else if (c.includes('√©cole') || c.includes('lyc√©e') || c.includes('coll√®ge') || c.includes('poste') || c.includes('mairie') || c.includes('ville')) {
      type = 'ecole'; emoji = 'üéì';
      if (c.includes('poste') || c.includes('mairie')) emoji = 'üè¢';
    } else if (c.includes('restaurant') || c.includes('snack') || c.includes('pizzeria') || c.includes('fast food')) {
      type = 'restaurant'; emoji = 'üç¥';
    } else if (c.includes('caf√©') || c.includes('salon de th√©') || c.includes('buvette')) {
      type = 'cafe'; emoji = '‚òï';
    } else if (c.includes('h√¥tel') || c.includes('hotel') || c.includes('r√©sidence') || c.includes('maison d\'h√¥tes')) {
      type = 'hotel'; emoji = 'üè®';
    } else if (c.includes('plage') || c.includes('baignade') || c.includes('mer')) {
      type = 'plage'; emoji = 'üèñÔ∏è';
    } else if (c.includes('port') || c.includes('p√™che') || c.includes('bateau')) {
      type = 'port'; emoji = '‚öì';
    } else if (c.includes('mosqu√©e') || c.includes('zaouia')) {
      type = 'culture'; emoji = 'üïå';
    } else if (c.includes('histoire') || c.includes('mus√©e') || c.includes('ruine') || c.includes('site')) {
      type = 'culture'; emoji = 'üèõÔ∏è';
    }

    return L.divIcon({
      className: 'custom-div-icon',
      html: `<div class="marker-pin ${type}"><span>${emoji}</span></div>`,
      iconSize: [42, 42],
      iconAnchor: [21, 42],
      popupAnchor: [0, -45]
    });
  }
}

=== END FILE: src/app/features/map/pages/map-page/map-page.component.ts ===

=== BEGIN FILE: src/app/features/map/pages/place-detail/place-detail.component.ts ===
// Fichier : src/app/features/map/pages/place-detail/place-detail.component.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Component, OnInit, inject } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ActivatedRoute, RouterModule } from '@angular/router';
import { LeafletModule } from '@bluehalo/ngx-leaflet';
import { FormsModule } from '@angular/forms';
import * as L from 'leaflet';
import { Observable, of } from 'rxjs';
import { switchMap, tap, map } from 'rxjs/operators';

import { PlacesService } from '../../../../core/services/places.service';
import { Place } from '../../../../core/models/place.model';
import { AuthService } from '../../../../core/services/auth.service';
import { User } from '../../../../core/models/user.model';

@Component({
  selector: 'app-place-detail',
  standalone: true,
  imports: [CommonModule, LeafletModule, RouterModule, FormsModule],
  templateUrl: './place-detail.component.html',
  styleUrls: ['./place-detail.component.css']
})
export class PlaceDetailComponent implements OnInit {
  private route = inject(ActivatedRoute);
  private placesService = inject(PlacesService);
  private authService = inject(AuthService);

  place$: Observable<Place | undefined> = of(undefined);

  isAdmin$: Observable<boolean> = this.authService.user$.pipe(
    map((user: User | null | undefined) => !!user && Array.isArray(user.roles) && user.roles.includes('admin'))
  );

  editMode = false;
  editedDescription = '';
  editedImages: string[] = [];
  private currentPlaceId: string | null = null;

  mapOptions: L.MapOptions = {
    layers: [
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 18 })
    ],
    zoom: 14,
    center: L.latLng(34.71, 11.15)
  };

  mapLayers: L.Layer[] = [];

  constructor() {
    const iconRetinaUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png';
    const iconUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png';
    const shadowUrl = 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png';

    L.Marker.prototype.options.icon = L.icon({
      iconRetinaUrl,
      iconUrl,
      shadowUrl,
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      tooltipAnchor: [16, -28],
      shadowSize: [41, 41]
    });
  }

  ngOnInit(): void {
    this.place$ = this.route.paramMap.pipe(
      switchMap(params => {
        const id = params.get('id');
        if (id) {
          return this.placesService.getPlaceById(id);
        }
        return of(undefined);
      }),
      tap(place => {
        if (place) {
          this.currentPlaceId = place.id || null;
          this.editedDescription = place.description || '';
          this.editedImages = Array.isArray(place.images) ? [...place.images] : [];
          this.updateMap(place);
        }
      })
    );
  }

  toggleEdit(): void {
    this.editMode = !this.editMode;
  }

  addImageField(): void {
    this.editedImages.push('');
  }

  removeImage(index: number): void {
    this.editedImages.splice(index, 1);
  }

  saveChanges(place: Place): void {
    if (!this.currentPlaceId) {
      return;
    }

    const payload: Partial<Place> = {
      description: this.editedDescription,
      images: this.editedImages.filter(url => !!url),
      updatedAt: new Date()
    };

    this.placesService.updatePlace(this.currentPlaceId, payload)
      .then(() => {
        this.editMode = false;
      })
      .catch(err => {
        console.error('Erreur lors de la mise √† jour du lieu', err);
        alert('Erreur lors de la sauvegarde des modifications');
      });
  }

  updateMap(place: Place) {
    this.mapOptions = {
      ...this.mapOptions,
      center: L.latLng(place.latitude, place.longitude)
    };

    this.mapLayers = [
      L.marker([place.latitude, place.longitude]).bindPopup(place.name)
    ];
  }
}

=== END FILE: src/app/features/map/pages/place-detail/place-detail.component.ts ===

=== BEGIN FILE: src/app/features/map/pages/place-detail/place-detail.component.css ===
// Fichier : src/app/features/map/pages/place-detail/place-detail.component.css
// Date d'inclusion : 2025-11-23 13:27:07


=== END FILE: src/app/features/map/pages/place-detail/place-detail.component.css ===

=== BEGIN FILE: src/app/features/map/pages/place-detail/place-detail.component.html ===
// Fichier : src/app/features/map/pages/place-detail/place-detail.component.html
// Date d'inclusion : 2025-11-23 13:27:07

<div class="min-h-screen bg-gray-50 pb-12" *ngIf="place$ | async as place; else loading">

  <div class="relative h-64 md:h-80 w-full bg-gray-800 overflow-hidden">
    <img *ngIf="place.images && place.images.length > 0"
         [src]="place.images[0]"
         class="w-full h-full object-cover opacity-70"
         [alt]="place.name" />

    <div *ngIf="!place.images || place.images.length === 0"
         class="w-full h-full bg-gradient-to-r from-blue-900 to-blue-700 opacity-80">
    </div>

    <div class="absolute inset-0 bg-black/20"></div>

    <div class="absolute bottom-0 left-0 w-full p-6 md:p-10">
      <div class="container mx-auto flex flex-col gap-3">
        <div class="flex flex-wrap gap-2 mb-1">
          <span *ngFor="let cat of place.categories"
                class="bg-yellow-500 text-blue-900 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide">
            {{ cat }}
          </span>
        </div>

        <div class="flex items-center justify-between gap-4">
          <h1 class="text-3xl md:text-4xl font-bold text-white drop-shadow-md">
            {{ place.name }}
          </h1>

          <button *ngIf="isAdmin$ | async"
                  type="button"
                  (click)="toggleEdit()"
                  class="hidden md:inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white/90 text-sm font-semibold text-blue-700 shadow hover:bg-white">
            <span>‚úèÔ∏è {{ editMode ? 'Fermer l‚Äô√©dition' : 'Modifier' }}</span>
          </button>
        </div>
      </div>
    </div>

    <a routerLink="/"
       class="absolute top-4 left-4 bg-white/20 hover:bg-white/30 text-white p-2 rounded-full backdrop-blur shadow transition">
      <svg xmlns="http://www.w3.org/2000/svg"
           class="h-6 w-6"
           viewBox="0 0 24 24"
           fill="none"
           stroke="currentColor"
           stroke-width="2"
           stroke-linecap="round"
           stroke-linejoin="round">
        <path d="M15 18l-6-6 6-6" />
      </svg>
    </a>
  </div>

  <div class="container mx-auto px-4 -mt-8 relative z-10">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <div class="md:col-span-2 space-y-6">
        <div class="bg-white rounded-xl shadow-sm p-6 md:p-8 border border-gray-100">
          <div class="flex items-center justify-between gap-2 mb-4 border-b pb-2">
            <h2 class="text-xl font-bold text-gray-800">√Ä propos</h2>

            <button *ngIf="isAdmin$ | async"
                    type="button"
                    (click)="toggleEdit()"
                    class="inline-flex md:hidden items-center gap-2 px-3 py-1.5 rounded-lg bg-blue-600 text-xs font-semibold text-white shadow hover:bg-blue-700">
              <span>‚úèÔ∏è {{ editMode ? 'Fermer l‚Äô√©dition' : 'Modifier' }}</span>
            </button>
          </div>

          <p *ngIf="!editMode" class="text-gray-600 leading-relaxed text-lg">
            {{ place.description }}
          </p>

          <form *ngIf="(isAdmin$ | async) && editMode"
                (ngSubmit)="saveChanges(place)"
                class="space-y-4">
            <div>
              <label class="block text-xs font-medium text-gray-700 mb-1">Description</label>
              <textarea [(ngModel)]="editedDescription"
                        name="description"
                        rows="4"
                        class="w-full rounded-md border border-gray-300 text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
            </div>

            <div>
              <label class="block text-xs font-medium text-gray-700 mb-1">Images (URLs)</label>
              <div class="space-y-2">
                <div *ngFor="let img of editedImages; let i = index" class="flex items-center gap-2">
                  <input [(ngModel)]="editedImages[i]"
                         [name]="'image_' + i"
                         type="text"
                         class="flex-1 rounded-md border border-gray-300 text-xs px-2 py-1 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"
                         placeholder="https://..." />
                  <button type="button"
                          class="text-xs text-red-600 hover:underline"
                          (click)="removeImage(i)">
                    Supprimer
                  </button>
                </div>

                <button type="button"
                        class="text-xs text-blue-600 hover:underline"
                        (click)="addImageField()">
                  + Ajouter une image
                </button>
              </div>
            </div>

            <div class="flex justify-end gap-2 pt-2">
              <button type="button"
                      class="px-3 py-1.5 text-xs rounded-md border border-gray-300"
                      (click)="toggleEdit()">
                Annuler
              </button>
              <button type="submit"
                      class="px-3 py-1.5 text-xs rounded-md bg-blue-600 text-white font-semibold hover:bg-blue-700">
                Enregistrer
              </button>
            </div>
          </form>
        </div>

        <div *ngIf="place.images && place.images.length > 1"
             class="bg-white rounded-xl shadow-sm p-4 border border-gray-100">
          <h3 class="text-sm font-semibold text-gray-800 mb-3">Galerie</h3>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
            <img *ngFor="let img of place.images; let i = index"
                 [src]="img"
                 class="w-full h-32 object-cover rounded-lg border border-gray-100"
                 [alt]="place.name + ' image ' + (i + 1)" />
          </div>
        </div>
      </div>

      <div class="space-y-4">
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
          <div class="p-4 border-b">
            <h2 class="text-sm font-semibold text-gray-800">Localisation</h2>
            <p class="text-xs text-gray-500 mt-1">
              {{ place.latitude | number:'1.4-4' }}, {{ place.longitude | number:'1.4-4' }}
            </p>
          </div>
          <div class="h-64">
            <div leaflet
                 [leafletOptions]="mapOptions"
                 [leafletLayers]="mapLayers"
                 class="h-full w-full rounded-b-xl overflow-hidden">
            </div>
          </div>
        </div>

        <a [href]="'https://www.google.com/maps/search/?api=1&query=' + place.latitude + ',' + place.longitude"
           target="_blank"
           rel="noopener"
           class="block w-full bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold py-3 rounded-lg shadow flex items-center justify-center gap-2">
          <span>üó∫Ô∏è Y aller (Google Maps)</span>
        </a>
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <div class="h-screen flex items-center justify-center bg-gray-50">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
  </div>
</ng-template>

=== END FILE: src/app/features/map/pages/place-detail/place-detail.component.html ===

=== BEGIN FILE: src/app/features/map/pages/place-detail/place-detail.component.spec.ts ===
// Fichier : src/app/features/map/pages/place-detail/place-detail.component.spec.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { ComponentFixture, TestBed } from '@angular/core/testing';

import { PlaceDetailComponent } from './place-detail.component';

describe('PlaceDetailComponent', () => {
  let component: PlaceDetailComponent;
  let fixture: ComponentFixture<PlaceDetailComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [PlaceDetailComponent]
    })
    .compileComponents();

    fixture = TestBed.createComponent(PlaceDetailComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});

=== END FILE: src/app/features/map/pages/place-detail/place-detail.component.spec.ts ===

=== BEGIN FILE: src/app/app.css ===
// Fichier : src/app/app.css
// Date d'inclusion : 2025-11-23 13:27:07


=== END FILE: src/app/app.css ===

=== BEGIN FILE: src/app/app.component.ts ===
// Fichier : src/app/app.component.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { Component } from '@angular/core';
import { RouterOutlet } from '@angular/router';
import { HeaderComponent } from './core/components/header/header.component';
import { FooterComponent } from './core/components/footer/footer.component';

@Component({
  selector: 'app-root',
  standalone: true,
  imports: [RouterOutlet, HeaderComponent, FooterComponent],
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent {}

=== END FILE: src/app/app.component.ts ===

=== BEGIN FILE: src/app/app-routing-module.ts ===
// Fichier : src/app/app-routing-module.ts
// Date d'inclusion : 2025-11-23 13:27:07

import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';

// Composants (Chemins bas√©s sur l'architecture du script 02)
import { MapPageComponent } from './features/map/pages/map-page/map-page.component';
import { PlaceDetailComponent } from './features/map/pages/place-detail/place-detail.component';
import { AddPlaceComponent } from './features/admin/pages/add-place/add-place.component';
import { LoginComponent } from './features/auth/pages/login/login.component';
import { AdminListComponent } from './features/admin/pages/admin-list/admin-list.component';

// Guards
import { AuthGuard } from './core/guards/auth.guard';
import { AdminGuard } from './core/guards/admin.guard';

const routes: Routes = [
  // Route par d√©faut : Carte
  { path: '', component: MapPageComponent },

  // D√©tail d'un lieu
  { path: 'place/:id', component: PlaceDetailComponent },

  // Ajout d'un lieu (Prot√©g√© par AuthGuard)
  { path: 'add-place', component: AddPlaceComponent, canActivate: [AuthGuard] },

  // Login
  { path: 'login', component: LoginComponent },

  // Section Admin (Prot√©g√©e par AdminGuard)
  { 
    path: 'admin',
    canActivate: [AdminGuard],
    children: [
        { path: 'places', component: AdminListComponent },
        // On pourrait ajouter une route pour les lieux 'pending' sp√©cifiquement ici
        { path: 'places/pending', component: AdminListComponent }, 
        { path: '', redirectTo: 'places', pathMatch: 'full' }
    ]
  },

  // Redirection wildcard
  { path: '**', redirectTo: '' }
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
export class AppRoutingModule { }

=== END FILE: src/app/app-routing-module.ts ===

=== BEGIN FILE: src/app/app.component.css ===
// Fichier : src/app/app.component.css
// Date d'inclusion : 2025-11-23 13:27:08


=== END FILE: src/app/app.component.css ===

=== BEGIN FILE: src/main.ts ===
// Fichier : src/main.ts
// Date d'inclusion : 2025-11-23 13:27:08

import { bootstrapApplication } from '@angular/platform-browser';
import { AppComponent } from './app/app.component';
import { provideRouter, withComponentInputBinding } from '@angular/router';
import { routes } from './app/app.routes';
import { importProvidersFrom } from '@angular/core';

// Nouveaux imports Firebase (Modulaires)
import { provideFirebaseApp, initializeApp } from '@angular/fire/app';
import { provideAuth, getAuth } from '@angular/fire/auth';
import { provideFirestore, getFirestore } from '@angular/fire/firestore';

// On garde FIREBASE_OPTIONS pour la compatibilit√© si besoin, mais on privil√©gie la nouvelle m√©thode
import { FIREBASE_OPTIONS } from '@angular/fire/compat';

import { environment } from './environments/environment';

bootstrapApplication(AppComponent, {
  providers: [
    provideRouter(routes, withComponentInputBinding()),

    // Initialisation Firebase Modulaire (Recommand√©e pour Standalone)
    provideFirebaseApp(() => initializeApp(environment.firebaseConfig)),
    provideAuth(() => getAuth()),
    provideFirestore(() => getFirestore()),

    // Provider de compatibilit√© (Pour que votre AuthService existant continue de marcher avec 'compat')
    { provide: FIREBASE_OPTIONS, useValue: environment.firebaseConfig }
  ]
}).catch(err => console.error(err));

=== END FILE: src/main.ts ===

=== BEGIN FILE: src/styles.css ===
// Fichier : src/styles.css
// Date d'inclusion : 2025-11-23 13:27:08

/* Tailwind CSS v3 Directives */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Styles globaux */
html, body { height: 100%; margin: 0; }

=== END FILE: src/styles.css ===

=== BEGIN FILE: src/environments/environment.prod.ts ===
// Fichier : src/environments/environment.prod.ts
// Date d'inclusion : 2025-11-23 13:27:08

export const environment = {
  production: true,
  firebaseConfig: {
    apiKey: 'AIzaSyA36WJbXgjRzOjLvU4WM6ZXp4CLWff-0-o',
    authDomain: 'kerkennahmap.firebaseapp.com',
    projectId: 'kerkennahmap',
    storageBucket: 'kerkennahmap.firebasestorage.app',
    messagingSenderId: '271484483702',
    appId: '1:271484483702:web:5557f410ceaacac2010757',
    measurementId: 'G-FXFDCLE25Q'
  },
  supabaseUrl: 'https://bcuxfuqgwoqyammgmpjw.supabase.co',
  supabaseKey: 'sb_secret_GnRXdBMwhJqpO4LZGKfwKg_HbVpIYjh'
};

=== END FILE: src/environments/environment.prod.ts ===

=== BEGIN FILE: src/environments/environment.ts ===
// Fichier : src/environments/environment.ts
// Date d'inclusion : 2025-11-23 13:27:08

export const environment = {
  production: false,
  firebaseConfig: {
    apiKey: 'AIzaSyA36WJbXgjRzOjLvU4WM6ZXp4CLWff-0-o',
    authDomain: 'kerkennahmap.firebaseapp.com',
    projectId: 'kerkennahmap',
    storageBucket: 'kerkennahmap.firebasestorage.app',
    messagingSenderId: '271484483702',
    appId: '1:271484483702:web:5557f410ceaacac2010757',
    measurementId: 'G-FXFDCLE25Q'
  },
  supabaseUrl: 'https://bcuxfuqgwoqyammgmpjw.supabase.co',
  supabaseKey: 'sb_secret_GnRXdBMwhJqpO4LZGKfwKg_HbVpIYjh'
};

=== END FILE: src/environments/environment.ts ===

